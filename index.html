<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Profile Info</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-800 text-white flex items-center justify-center min-h-screen">

    <div class="w-full max-w-lg bg-gray-900 text-white rounded-lg overflow-hidden shadow-lg">
        <div class="p-6">
            <h1 class="text-3xl font-bold text-center">Telegram User Info</h1>
            <div class="mt-6">
                <button id="fetchInfoBtn" class="w-full py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-semibold">Get User Info</button>
            </div>
            <div id="userInfo" class="mt-6 hidden space-y-4">
                <h2 class="text-lg font-semibold">User Info</h2>
                <p id="name"></p>
                <p id="username-display"></p>
                <p id="user-id"></p>
                <p id="account-age"></p>
                <p id="premium-status"></p>
                <img id="profile-pic" class="w-24 h-24 rounded-full mx-auto mt-4" alt="Profile Picture">
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;

        // Show full screen on load
        tg.expand();

        // Function to fetch user info from Telegram Web App
        function getTelegramUserInfo() {
            const user = tg.initDataUnsafe.user;

            if (user) {
                return {
                    first_name: user.first_name,
                    last_name: user.last_name || "",
                    username: user.username || "No username",
                    id: user.id,
                    photo_url: user.photo_url || "https://via.placeholder.com/100"
                };
            } else {
                alert("Unable to fetch user data. Please ensure this is opened within the Telegram app.");
                return null;
            }
        }

        // Function to fetch additional info (e.g., account age, premium status) from Google Apps Script
        async function fetchAdditionalInfo(userInfo) {
            const response = await fetch("https://script.google.com/macros/s/AKfycbyjXrDuiJGoNULTLwQDtncg1KE0L4OSZ4SSFNmWfi0gTVLQ3yh3uGlQROsP1VqCqSGRtQ/exec", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ user_id: userInfo.id })
            });

            const data = await response.json();
            return data;
        }

        // Handle button click
        document.getElementById("fetchInfoBtn").onclick = async function() {
            const userInfo = getTelegramUserInfo();

            if (userInfo) {
                // Display user info
                document.getElementById("name").textContent = `Name: ${userInfo.first_name} ${userInfo.last_name}`;
                document.getElementById("username-display").textContent = `Username: @${userInfo.username}`;
                document.getElementById("user-id").textContent = `ID: ${userInfo.id}`;
                document.getElementById("profile-pic").src = userInfo.photo_url;

                // Fetch additional user info (account age, premium status)
                const additionalInfo = await fetchAdditionalInfo(userInfo);

                if (additionalInfo) {
                    document.getElementById("account-age").textContent = `Account Age: ${additionalInfo.account_age}`;
                    document.getElementById("premium-status").textContent = additionalInfo.is_premium ? "Premium User" : "Free User";
                }

                // Show user info section
                document.getElementById("userInfo").classList.remove("hidden");
            }
        };
    </script>
</body>
</html>
