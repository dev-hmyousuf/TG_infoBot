<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <!-- Profile Container -->
    <div class="w-full max-w-xl bg-gray-800 text-white rounded-lg overflow-hidden shadow-lg">
        <!-- Profile Header -->
        <div class="bg-gray-700 p-6 flex items-center space-x-4 border-b border-gray-600">
            <img id="profile-pic" class="w-24 h-24 rounded-full border-2 border-blue-500" alt="Profile Picture">
            <div>
                <h1 id="name" class="text-2xl font-semibold">Loading...</h1>
                <p id="username" class="text-gray-400 text-sm"></p>
                <p id="user-id" class="text-gray-500 text-xs"></p>
                <p id="account-created" class="text-gray-500 text-xs"></p>
            </div>
        </div>

        <!-- User Info Section -->
        <div class="p-6 space-y-4">
            <h2 class="text-xl font-semibold">Additional Info</h2>
            <p id="account-age" class="text-sm text-gray-400"></p>
            <p id="premium-status" class="text-sm text-gray-400"></p>
        </div>

        <!-- Action Buttons -->
        <div class="p-6 space-y-4">
            <button class="w-full py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-semibold"
                onclick="toggleFullscreen()">Toggle Fullscreen</button>
            <button class="w-full py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white font-semibold"
                onclick="window.Telegram.WebApp.close()">Close App</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;

        // Ensure full-screen experience
        tg.expand();

        // Function to fetch basic user data
        function getTelegramUserInfo() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                return {
                    first_name: user.first_name,
                    last_name: user.last_name || "",
                    username: user.username || "No username",
                    id: user.id,
                    photo_url: user.photo_url || "https://via.placeholder.com/100"
                };
            } else {
                alert("Unable to fetch user data. Ensure this is opened inside the Telegram app.");
                return null;
            }
        }

        // Fetch additional info (account age, premium status) from Google Apps Script
        async function fetchAdditionalInfo(userInfo) {
            const response = await fetch("https://script.google.com/macros/s/AKfycbyjXrDuiJGoNULTLwQDtncg1KE0L4OSZ4SSFNmWfi0gTVLQ3yh3uGlQROsP1VqCqSGRtQ/exec", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ user_id: userInfo.id })
            });

            const data = await response.json();
            return data;
        }

        // When the page loads, show the user info
        window.onload = async function() {
            const userInfo = getTelegramUserInfo();

            if (userInfo) {
                // Show basic user info
                document.getElementById("name").textContent = `${userInfo.first_name} ${userInfo.last_name}`;
                document.getElementById("username").textContent = `@${userInfo.username}`;
                document.getElementById("user-id").textContent = `ID: ${userInfo.id}`;
                document.getElementById("profile-pic").src = userInfo.photo_url;

                // Fetch additional info (account age, premium status)
                const additionalInfo = await fetchAdditionalInfo(userInfo);

                // Show additional user info
                document.getElementById("account-created").textContent = `Account Created: ${additionalInfo.account_creation_date}`;
                document.getElementById("account-age").textContent = `Account Age: ${additionalInfo.account_age}`;
                document.getElementById("premium-status").textContent = additionalInfo.is_premium ? "Premium User" : "Free User";
            }
        };

        // Function to toggle fullscreen mode
        function toggleFullscreen() {
            tg.isExpanded ? tg.close() : tg.expand();
        }
    </script>

</body>
</html>
